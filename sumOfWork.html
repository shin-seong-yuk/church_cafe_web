<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>총 근무 시간 · BOKDEUL'S COFFEE</title>
    <style>
      /* ====== 기본 설정 & 변수 ====== */
      * { box-sizing: border-box; }
      :root{
        --name-col: 0.25;
        --time-col: 0.25;
        --card-max: 720px;
        --page-gutter: clamp(24px, 8vw, 120px);
      }

      html, body {
        background: rgb(242,239,218);
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
      }
      body{
        min-height: 100vh;
        margin: 0;
        display: grid;
        place-content: center;
        padding: 12px;
      }
      .sheet{ padding: 8px; }

      .card{
        background:#fff;
        border-radius:18px;
        border:1px solid #e2e8f0;
        box-shadow:
          0 0 0 2px rgba(0,0,0,0.20),
          0 12px 32px rgba(0,0,0,0.08);
        width: min(var(--card-max), calc(100vw - (var(--page-gutter) * 2)));
        margin: clamp(20px, 6vh, 72px) auto;
        padding:16px 14px;
        overflow:hidden;
        text-align:center;
        display:grid;
        gap:14px;
        padding-left: 6px;
        padding-right: 6px;
      }

      .title-top{
        color:#111827;
        font-weight:800;
        letter-spacing:-0.02em;
        font-size: clamp(24px, 4vw, 36px);
        margin: 6px 0 2px;
      }
      .title-sub{
        color:#334155;
        font-weight:800;
        font-size: clamp(16px, 2.5vw, 22px);
        margin: 0 0 6px;
      }

      table.roster{
        border-collapse: collapse;
        width: 100%;
        background:#fff;
        table-layout: fixed;
      }
      .roster col.name{ width: calc(var(--name-col) * 100%); }
      .roster col.time{ width: calc(var(--time-col) * 100%); }

      .roster td{
        border: 2.5px solid #000;
        vertical-align: middle;
        text-align: center;
        color:#111827;
        font-size: clamp(14px, 1.8vw, 16px);
        font-weight:700;
        padding:12px 6px;
        word-break: keep-all;
        background:#fff;
      }
      .roster tr td:first-child{ font-weight:800; }

      .brand-note{
        margin-top:10px;
        text-align:center;
        font-weight:800;
        letter-spacing:.18em;
        color:#1f2937;
        font-size:12px;
        opacity:.95;
      }

      .card{ overflow-x: auto; }

      @media print{
        body{ place-content:start; background:#fff; }
        .card{
          box-shadow:none;
          border-color:#cbd5e1;
          width: 100%;
          max-width: none;
          margin: 0 auto;
        }
      }
    </style>
  </head>
  <body>
    <main class="sheet" role="main">
      <div class="card">
        <div class="title-top">BOKDEUL'S COFFEE</div>
        <div class="title-sub">총 시간 확인하기</div>

        <table class="roster" aria-label="총 근무 시간 표">
          <colgroup>
            <col class="name"><col class="time"><col class="name"><col class="time">
          </colgroup>
          <!-- ✅ 여기! tbody 안을 비워두고 id만 붙임 -->
          <tbody id="summary-body"></tbody>
        </table>
      </div>

      <div class="brand-note">BOKDEUL'S COFFEE</div>
    </main>

    <script>
      // ===== 1) 전체 이름 목록 =====
      const ALL_NAMES = [
        "고희경",
        "김예원",
        "김예은",
        "김예지",
        "박지원",
        "박태웅",
        "신성욱",
        "이지은",
        "이창원",
        "장준영",
        "하우현"
      ];

      // ===== 2) 날짜별 근무 기록(localStorage에서 불러오기) =====
const STORAGE_KEY = "bokdeul-work-log-v1";

//  localStorage 구조:
//  {
//    "2024-11-30": { "박지원": 60, "박태웅": 60, ... },
//    "2024-12-07": { ... },
//    ...
//  }
function loadWorkLogFromStorage(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return [];

    const data = JSON.parse(raw);
    const list = [];

    for (const [date, perName] of Object.entries(data)) {
      for (const [name, minutes] of Object.entries(perName)) {
        list.push({ date, name, minutes });
      }
    }
    return list;
  }catch(e){
    console.error("근무 기록 불러오기 실패:", e);
    return [];
  }
}

const WORK_LOG = loadWorkLogFromStorage();

// 필요하면 여기에 수동으로 추가도 가능 (예외 케이스 보정용)
// WORK_LOG.push({ date: "2024-12-28", name: "이지은", minutes: 45 });


      // ===== 유틸 =====
      function startOfDay(date){
        const d = new Date(date);
        d.setHours(0,0,0,0);
        return d;
      }
      function parseYMD(ymd){
        const [y,m,d] = ymd.split("-").map(Number);
        return new Date(y, m-1, d);
      }
      function formatMinutes(min){
        if (!min) return "-";
        const h = Math.floor(min / 60);
        const m = min % 60;
        const parts = [];
        if (h > 0) parts.push(`${h}h`);
        if (m > 0) parts.push(`${m}m`);
        return parts.join(" ");
      }

      // ===== 합산 & 렌더 =====
      (function buildSummary(){
        const today = startOfDay(new Date());

        // name → totalMinutes
        const totals = new Map();
        ALL_NAMES.forEach(name => totals.set(name, 0));

        WORK_LOG.forEach(entry => {
          const workDate = startOfDay(parseYMD(entry.date));
          if (workDate > today) return; // 아직 안 지난 날짜는 합산 X

          if (!totals.has(entry.name)) totals.set(entry.name, 0);
          const prev = totals.get(entry.name) || 0;
          totals.set(entry.name, prev + entry.minutes);
        });

        const entries = Array.from(totals.entries())
          .sort((a,b) => a[0].localeCompare(b[0], "ko"));

        const tbody = document.getElementById("summary-body");
        if (!tbody) return;
        tbody.innerHTML = "";

        // 2명씩 한 행
        for (let i = 0; i < entries.length; i += 2){
          const tr = document.createElement("tr");

          const [name1, min1] = entries[i];
          const pair = entries[i+1];
          const name2 = pair ? pair[0] : "-";
          const min2  = pair ? pair[1] : 0;

          const tdName1 = document.createElement("td");
          tdName1.textContent = name1;
          const tdTime1 = document.createElement("td");
          tdTime1.textContent = formatMinutes(min1);

          const tdName2 = document.createElement("td");
          tdName2.textContent = name2;
          const tdTime2 = document.createElement("td");
          tdTime2.textContent = name2 === "-" ? "-" : formatMinutes(min2);

          tr.appendChild(tdName1);
          tr.appendChild(tdTime1);
          tr.appendChild(tdName2);
          tr.appendChild(tdTime2);

          tbody.appendChild(tr);
        }
      })();
    </script>
  </body>
</html>
